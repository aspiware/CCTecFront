<ModalStack dismissEnabled="true" class="modal-root">
  <GridLayout rows="*" columns="*">
    <StackLayout row="0" col="0" class="backdrop" (tap)="close()"></StackLayout>

    <GridLayout row="0" col="0" rows="auto,auto" class="modal-card">
      <GridLayout row="0" columns="*" class="header header-fixed">
        <Label col="0" text="Microsoft Authenticator" class="title modal-title-text"></Label>
      </GridLayout>

      <StackLayout row="1" class="content" [formGroup]="form">
        <Label text="Enter the verification code" class="subtitle"></Label>

        <FlexboxLayout class="digits-row" (tap)="focusCodeInput()" (longPress)="pasteCodeFromClipboard()">
          <Label
            *ngFor="let i of digitIndexes"
            [text]="getDigitDisplay(i)"
            class="code-digit-box"
            [class.code-digit-active]="isActiveDigit(i)"
            textAlignment="center">
          </Label>
        </FlexboxLayout>
        <TextField
          class="hidden-code-input"
          [text]="codeText"
          keyboardType="number"
          maxLength="6"
          autocorrect="false"
          autocapitalizationType="none"
          (loaded)="onHiddenCodeLoaded($event)"
          (focus)="onHiddenCodeFocus()"
          (blur)="onHiddenCodeBlur()"
          (textChange)="onHiddenCodeTextChange($event)">
        </TextField>

        <GridLayout columns="*,12,*" class="actions-row">
          <Button col="0" text="Cancel" class="btn-secondary" (tap)="close()"></Button>
          <GridLayout col="2" class="verify-btn-wrap">
            <Button
              [text]="isVerifying ? '' : 'Verify'"
              class="btn-primary"
              [isEnabled]="codeText.length === 6 && !isVerifying"
              (tap)="verify()">
            </Button>
            <ActivityIndicator
              [busy]="isVerifying"
              [visibility]="isVerifying ? 'visible' : 'collapsed'"
              class="verify-spinner-overlay">
            </ActivityIndicator>
          </GridLayout>
        </GridLayout>
      </StackLayout>
    </GridLayout>
  </GridLayout>
</ModalStack>
